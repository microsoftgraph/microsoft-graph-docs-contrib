# Platform specific walkthroughs

Try out a sample REST call in our [API Explorer](https://graphexplorer2.azurewebsites.net/).

Once you're done exploring the API, come back here and select your favorite platform on the left. We'll guide you through the steps to write a simple application to send an email using the API.

If your preferred platform isn't listed yet, continue reading on this page. We'll go through the same set of steps using raw HTTP requests.

## Getting Started with the Microsoft Graph API and REST

The purpose of this guide is to walk through the process of calling the Microsoft Graph API to retrieve and send messages in Office 365 and Outlook.com. Unlike the platform-specific getting started guides, this guide focuses on the OAuth and REST requests and responses. It will cover the sequence of requests and responses that an app uses to authenticate and retrieve messages.

With the information in this guide, you can implement this in any language or platform capable of sending HTTP requests.

## Use OAuth2 to authenticate

In order to call the Microsoft Graph, the app requires an access token from Azure Active Directory. In order to do that, the app implements the [Authorization Grant Flow](https://msdn.microsoft.com/en-us/library/azure/dn645542.aspx). However, before this will work, the app must be registered to use authentication and authorization flows according to industry-standard  [OAuth 2.0 protocols](http://tools.ietf.org/html/rfc6749).

### Registering an app

There are currently two options:

1. Register using the generally available model for an app that will interact with Office 365 commercial users, work or school accounts:
 
   In order for your app to access a user's work or school account through the Microsoft Graph API, you first need to    register it with Azure AD. Once you've registered your app, you can manage it through the  [Azure Management Portal](https://manage.windowsazure.com).

2. Experiment with the latest functionality and register app that works for both consumer and commercial services:
 
   Now in preview, a single authentication service for both work or school and personal accounts. This model provides a single authentication service for both work and school (Azure AD) as well as personal (Microsoft) identities. Now, you need only implement one authentication flow in your app to enable users to use either work or school accounts, like Office 365 or OneDrive for Business, or personal accounts, like Outlook.com or OneDrive.
Use the  [Application Registration Portal](https://apps.dev.microsoft.com/) to register your app to implement the v2.0 app model preview.

Please note that because the v2.0 app model is currently in preview, it's not quite ready for use in production-level apps. For more information on features and functionality of the v2.0 app model that are not yet supported in the public preview period, see  [Limitations and restrictions of the V2.0 app model preview](https://azure.microsoft.com/en-us/documentation/articles/active-directory-v2-limitations/).

Once you register the app, you will have a client ID and secret. These are used in the Authorization Grant Flow.

The rest of this document assumes a registration on the generally available model, the links above have samples for the preview model.

### **Getting an authorization code**

The first step in the Authorization Grant Flow is to get an authorization code. That code is returned to the app by Azure when the user logs on and consents to the level of access the app requires.

First the app constructs a logon URL for the user. This URL must be opened in a browser so that the user can login and provide consent.

The base URL for logon looks like:

`https://login.microsoftonline.com/common/oauth2/authorize`

or

`https://login.microsoftonline.com/common/oauth2/v2.0/authorize` if you have registered the app using the preview. 


The app appends query parameters to this base URL to let Azure know what app is requesting the logon, and what permissions it is requesting.

- `client\_id:` the client ID generated by registering the app. This lets Azure know which app is requesting the logon.
- `redirect\_uri:` the location that Azure will redirect to once the user has granted consent to the app. This value must correspond to the value of **Redirect URI** used when registering the app.
- `response\_type:` the type of response the app is expecting. For the Authorization Grant Flow, this should always becode.
- `resource:` the resource ID for the endpoint that the app will access. For Microsoft Graph, this is https://graph.microsoft.com
- `scope:` a space-delimited list of access scopes that your app requires. **Note**: only required in the preview model.

For example, an application that requires read access to mail would put all of those together to generate a request URL like the following:

#### **Authorization code request**

```http

GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=<CLIENT ID>&redirect_uri=http%3A%2F%2Flocalhost/myapp%2F&response_type=code&resource=http%3A%2F%2Fgraph.microsoft.com&scope=https%3A%2F%2Fgraph.microsoft.com%2Fmail.read

```

The user will be presented with a sign in screen that displays the name of the app. Once they sign in, if it is their first time using the app, the user will be presented with a list of the app permissions the app requires and asked to allow or deny. Assuming they allow the required access, the browser will be redirected to the redirect URI specified in the initial request.

#### **Redirect request after successful sign in**

```http
GET  HTTP/1.1 302 Found

Location: http://localhost/myapp/?code= AwABAAAA...cZZ6IgAA&session\_state=7B29111D-C220-4263-99AB-6F6E135D75EF&state=D79E5777-702E-4260-9A62-37F75FF22CCE
```
The value of the code query parameter in the URL is the authorization code. The next step is to exchange that code for an access token.

### **Getting an access token**

To get an access token, the app posts form-encoded parameters to the token request URL, which is always:

https://login.microsoftonline.com/common/oauth2/v2.0/token

The app includes the following parameters.

- `client_id`: the client ID generated by registering the app.
- `client_secret`: the client secret generated by registering the app.
- `code`: the authorization code obtained in the prior step.
- `redirect_uri`: this value must be the same as the value used in the authorization code request.
- `grant_type`: the type of grant the app is using. For the Authorization Grant Flow, this should always be authorization\_code.
- `resource`: the resource ID for the endpoint that the app will access. For Outlook, this is always https://graph.microsoft.com

These parameters are encoded to the application/x-www-form-urlencoded content type and sent to the token request URL.

#### **Access token request**
```http
POST https://login.microsoftonline.com/common/oauth2/v2.0/token
Content-Type: application/x-www-form-urlencoded

{
  grant_type=authorization_code
  &code=AwABAAAA...cZZ6IgAA
  &redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
  &resource=https%3A%2F%2Fgraph.microsoft.com%2F
  &client\_id=<CLIENT ID>
  &client\_secret=<CLIENT SECRET>
}
```
Azure responds with a JSON payload which includes the access token.

#### **Access token response**
```http
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "token_type":"Bearer",
  "expires_in":"3600",
  "access_token":"eyJ0eXAi...b66LoPVA",
  "scope":"https://graph.microsoft.com/mail.read",
  ...
}
```
The access token is found in the access_token field of the JSON payload. The app uses this value to set the Authorization header when making REST calls to the API.

## **Calling the Microsoft Graph**

Once the app has an access token, it's ready to call the Microsoft Graph. The documents here have all of the details. Since this sample app is retrieving messages, it will use an HTTP GET request to the https://graph.microsoft.com/v1.0/me/messages URL. This will retrieve messages from the inbox.

### **Refining the request**

Apps can control the behavior of GET requests by using Odata query parameters.  It is recommended that apps use these parameters to limit the number of results that are returned and to limit the fields that are returned for each item. Let's look at an example.

Consider an app that displays messages in a table. The table only displays the subject, sender, and the date and time the message was received. The table displays a maximum of 25 rows, and should be sorted so that the most recently received message is at the top.

To achieve this, the app uses the following query parameters:

- The $select parameter is used to specify only the subject, srom, and dateTimeReceived fields.
- The $top parameter is used to specify a maximum of 25 items.
- The $orderby parameter is used to sort the results by the dateTimeReceived field.

This results in the following request.

#### **Microsoft Graph request for messages in the inbox**
```http
GET https://graph.microsoft.com/v1.0/me/messages?$select=subject,from,receivedDateTime&$top=25&$orderby=receivedDateTime%20DESC
Accept: application/json
Authorization: Bearer eyJ0eXAi...b66LoPVA
```
#### **Microsoft Graph response**
```http
HTTP/1.1 200 OK
Content-type: application/json

{
    "id": "id-value",
    "dateTimeCreated": "2015-11-05T22:33:48Z",
    "lastModifiedDateTime": "2015-11-05T22:33:48Z",
    "bhangeKey": "CQAAABYAAABMR67yw0CmT4x0kVgQUH/3AAJHUywy",
    "categories": [],
    "dateTimeReceived": "2015-11-05T22:33:48Z",
    "dateTimeSent": "2015-11-05T22:33:48Z",
    "hasAttachments": false,
    "subject": "What is Clutter?",
    "body": {
        "contentType": "HTML",
        "content": "content"
    },
    "bodyPreview": "Stay on top of your email...",
    "importance": "Normal",
    "parentFolderId": "parentfoldeid-value",
    "sender": {
        "emailAddress": {
            "name": "Microsoft Outlook"
        }
    },
    "from": {
        "emailAddress": {
            "name": "Microsoft Outlook"
        }
    },
    "toRecipients": [
        {
            "emailAddress": {
                "name": "Sara Davis",
                "address": "SaraD@contoso.onmicrosoft.com"
            }
        }
    ],
    "ccRecipients": [],
    "bccRecipients": [],
    "replyTo": [],
    "conversationId": "converstion-id-value",
    "isDeliveryReceiptRequested": null,
    "isReadReceiptRequested": false,
    "isRead": false,
    "isDraft": false,
    "webLink": "https://outlook.office365.com/owa/?ItemID=id-value&viewmodel=ReadMessageItem",
    "inferenceClassification": "Focused"
}

```
Now that you've seen how to make calls to the Microsoft Graph, you can use the API reference to construct any other kinds of calls your app needs to make. However, bear in mind that your app needs to have the appropriate permissions configured on the app registration for the calls it makes.


